@using WildPay.Models.Entities
@model Expenditure

<div>
    <partial name="_GroupTitlePartial" model="ViewBag.Group"/>
    <hr/>
    <div class="row">
        <partial name="_GroupNavBarPartial" model="ViewBag.Group"/>
        <div class="col-md-9">
            <section>
                <h3>Modifier la dépense</h3>
                <form action='@Url.Action("UpdateExpenditure", "Expenditure", new { groupId = ViewBag.Group.Id })' method="post">

                    <input type="text" asp-for="@Model.Id" hidden="hidden" readonly/>

                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" asp-for="@Model.Name" />
                        <label class="control-label" asp-for="@Model.Name">Nom</label>
                        <span asp-validation-for="@Model.Name" class="text-danger"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input class="form-control" type="number" asp-for="@Model.Amount" step="0.01" min="0.01" />
                        <label class="control-label" asp-for="@Model.Amount">Montant</label>
                        <span asp-validation-for="@Model.Amount" class="text-danger"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input class="form-control" type="date" asp-for="@Model.Date" />
                        <label class="control-label" asp-for="@Model.Date">Date</label>
                        <span asp-validation-for="@Model.Date" class="text-danger"></span>
                    </div>

                    <div class="form-floating mb-3">
                        @Html.DropDownListFor(m => m.CategoryId, new SelectList(ViewBag.GroupCategoriesSelects, "Value", "Text"), "(Aucune catégorie)", new { @class = "form-select", id = "categoryDropdown" })
                        <label for="categoryDropdown" class="form-label">Catégorie</label>
                    </div>

                    <div class="form-floating mb-3">
                        @Html.DropDownListFor(m => m.PayerId, new SelectList(ViewBag.GroupUsersSelects, "Value", "Text"), "(Aucun payeur)", new { @class = "form-select", id = "payerDropdown" })
                        <label for="payerDropdown" class="form-label">Payé par</label>
                    </div>

                    <div id="checkboxDiv">
                        <label for="checkboxDiv">Contributeurs</label>
                        @foreach (var member in ViewBag.Group.ApplicationUsers)
                        {
                            if (Model.RefundContributors.Any(el => el.Id == member.Id))
                            {
                                <div class="form-check">
                                    <input type="checkbox" id="@member.Id" name="RefundContributors" value="@member.Id" checked />
                                    <label for="@member.Id">@member.Firstname @member.Lastname</label>
                                </div>
                            }
                            else
                            {
                                <div class="form-check">
                                    <input class="form-control" type="checkbox" id="@member.Id" name="RefundContributors" value="@member.Id" />
                                    <label class="control-label" for="@member.Id">@member.Firstname @member.Lastname</label>
                                </div>
                            }
                        }
                    </div>

                    <button class="w-100 btn btn-lg main-button" type="submit">Sauvegarder</button>
                </form>
                
                <a class="btn btn-danger d-flex justify-content-center align-items-center w-25" asp-action="DeleteExpenditure" asp-controller="Expenditure" asp-route-Id="@Model.Id"><span class="material-symbols-outlined">delete</span>Supprimer la dépense</a>
            </section>
        </div>
    </div>
</div>